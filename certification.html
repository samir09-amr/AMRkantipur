<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Advanced Certificate Generator</title>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700&family=Playfair+Display:wght@700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>
    <style>
        :root {
            --primary: #2c3e50;
            --secondary: #3498db;
            --accent: #e74c3c;
            --gold: #d4af37;
            --light: #ecf0f1;
            --dark: #2c3e50;
            --success: #27ae60;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Montserrat', sans-serif;
            background: linear-gradient(135deg, #f5f7fa 0%, #e4e7f1 100%);
            color: var(--dark);
            line-height: 1.6;
            padding: 20px;
            min-height: 100vh;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
        }
        
        header {
            text-align: center;
            margin-bottom: 30px;
            padding: 30px;
            background: linear-gradient(135deg, var(--primary), #1a2530);
            color: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        }
        
        header h1 {
            font-size: 2.8rem;
            font-weight: 700;
            font-family: 'Playfair Display', serif;
            letter-spacing: 1px;
            margin-bottom: 10px;
        }
        
        header p {
            font-size: 1.2rem;
            opacity: 0.9;
            max-width: 800px;
            margin: 0 auto;
        }
        
        .tabs {
            display: flex;
            background: white;
            border-radius: 10px 10px 0 0;
            overflow: hidden;
            margin-bottom: 0;
        }
        
        .tab-btn {
            flex: 1;
            padding: 20px;
            border: none;
            background: #e0e0e0;
            font-size: 1.2rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .tab-btn.active {
            background: var(--secondary);
            color: white;
        }
        
        .tab-content {
            display: none;
            background: white;
            border-radius: 0 0 10px 10px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        }
        
        .tab-content.active {
            display: block;
        }
        
        .app-container {
            display: flex;
            gap: 30px;
            margin-bottom: 40px;
        }
        
        .design-panel {
            flex: 0 0 400px;
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
            height: fit-content;
            overflow-y: auto;
            max-height: 90vh;
        }
        
        .preview-panel {
            flex: 1;
            display: flex;
            flex-direction: column;
        }
        
        .panel-title {
            font-size: 1.8rem;
            color: var(--primary);
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 3px solid var(--secondary);
            font-family: 'Playfair Display', serif;
        }
        
        .form-section {
            margin-bottom: 25px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
        }
        
        .form-section h3 {
            color: var(--primary);
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .form-section h3 i {
            color: var(--secondary);
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--primary);
        }
        
        input[type="text"], 
        input[type="date"],
        textarea,
        select,
        input[type="number"] {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-family: 'Montserrat', sans-serif;
            font-size: 1rem;
            transition: all 0.3s ease;
            background: white;
        }
        
        input[type="color"] {
            width: 100%;
            height: 45px;
            border: 2px solid #ddd;
            border-radius: 8px;
            cursor: pointer;
            background: white;
        }
        
        input:focus, textarea:focus, select:focus {
            border-color: var(--secondary);
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.2);
            outline: none;
        }
        
        textarea {
            min-height: 120px;
            resize: vertical;
        }
        
        .upload-control {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 12px;
        }
        
        .file-upload-label {
            padding: 12px 20px;
            background: linear-gradient(to right, var(--secondary), #2980b9);
            color: white;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            font-size: 0.95rem;
            white-space: nowrap;
        }
        
        .file-upload-label:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        .file-name {
            font-size: 0.9rem;
            color: #666;
            overflow: hidden;
            text-overflow: ellipsis;
            max-width: 180px;
        }
        
        .preview-container {
            flex: 1;
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
            display: flex;
            flex-direction: column;
        }
        
        .preview-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
        }
        
        .orientation-selector {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .orientation-btn {
            flex: 1;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
        }
        
        .orientation-btn:hover, .orientation-btn.active {
            border-color: var(--secondary);
            background: rgba(52, 152, 219, 0.1);
        }
        
        .certificate-wrapper {
            flex: 1;
            display: flex;
            justify-content: center;
            align-items: center;
            overflow: auto;
            background: #f0f4f8;
            border-radius: 12px;
            padding: 20px;
        }
        
        .certificate {
            position: relative;
            width: 21cm;
            height: 29.7cm;
            background: white;
            background-size: cover;
            background-position: center;
            border: 1px solid #e0e0e0;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.15);
            overflow: hidden;
        }
        
        .certificate.landscape {
            width: 29.7cm;
            height: 21cm;
        }
        
        .certificate-content {
            position: relative;
            z-index: 10;
            padding: 40px;
            width: 100%;
            height: 100%;
        }
        
        /* Draggable elements */
        .draggable {
            position: absolute;
            cursor: move;
            z-index: 100;
            transition: box-shadow 0.3s ease;
            min-width: 50px;
            min-height: 50px;
        }
        
        .draggable:hover {
            box-shadow: 0 0 0 2px var(--secondary);
        }
        
        .dragging {
            opacity: 0.8;
            box-shadow: 0 0 15px rgba(52, 152, 219, 0.7);
            z-index: 200;
        }
        
        /* Component specific styles */
        .logo {
            max-height: 80px;
            max-width: 150px;
            object-fit: contain;
        }
        
        .title-container {
            text-align: center;
        }
        
        .certificate-title {
            font-family: 'Playfair Display', serif;
            font-size: 3.5rem;
            color: #000;
            letter-spacing: 3px;
            margin-bottom: 5px;
            text-transform: uppercase;
            position: relative;
            display: inline-block;
        }
        
        .certificate-title::after {
            content: "";
            position: absolute;
            bottom: -15px;
            left: 50%;
            transform: translateX(-50%);
            width: 120px;
            height: 4px;
            background: linear-gradient(90deg, var(--gold), #f1c40f, var(--gold));
            border-radius: 3px;
        }
        
        .certificate-type {
            font-size: 1.8rem;
            color: #000;
            font-weight: normal;
            letter-spacing: 2px;
            margin-top: 10px;
            font-style: italic;
        }
        
        .certificate-presented {
            font-size: 1.3rem;
            margin-bottom: 5px;
            color: #000;
            font-style: italic;
        }
        
        .certificate-name {
            font-size: 2.5rem;
            font-weight: bold;
            margin: 10px 0;
            color: #000;
            padding: 10px 0;
            font-family: 'Montserrat', sans-serif;
            position: relative;
        }
        
        .certificate-name::before, .certificate-name::after {
            content: "✧";
            color: var(--gold);
            margin: 0 20px;
            font-size: 2rem;
        }
        
        .watermark {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 0;
            pointer-events: none;
            opacity: 0.1;
            max-width: 600px;
            max-height: 600px;
        }
        
        .certificate-text {
            font-size: 1.2rem;
            line-height: 1.7;
            margin: 15px auto;
            color: #000;
            max-width: 700px;
            position: relative;
            z-index: 10;
        }
        
        .certificate-details {
            font-size: 1.1rem;
            margin: 20px 0;
            color: #000;
            display: flex;
            justify-content: center;
            gap: 40px;
        }
        
        .certificate-details span {
            position: relative;
            padding: 0 20px;
            font-weight: 600;
        }
        
        .certificate-details span::before {
            content: "";
            position: absolute;
            top: 50%;
            left: -10px;
            width: 8px;
            height: 8px;
            background-color: var(--gold);
            border-radius: 50%;
            transform: translateY(-50%);
        }
        
        .signatures {
            display: flex;
            justify-content: space-around;
            width: 100%;
            margin-top: 30px;
            align-items: flex-start;
        }
        
        .signature {
            text-align: center;
            min-width: 200px;
            flex: 1;
            position: relative;
        }
        
        .signature-image {
            height: 120px;
            margin-bottom: 10px;
            object-fit: contain;
        }
        
        .signature-line {
            width: 150px;
            height: 2px;
            background: #000;
            margin: 0 auto 10px;
        }
        
        .signature-name {
            font-weight: bold;
            font-size: 1.1rem;
            margin-bottom: 5px;
        }
        
        .signature-title {
            font-size: 1rem;
            font-style: italic;
        }
        
        .qr-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            margin: 0 20px;
            padding: 15px;
            background: rgba(255, 255, 255, 0.8);
            border-radius: 10px;
            flex: 0.5;
        }
        
        .qr-code {
            width: 100px;
            height: 100px;
            background: transparent;
        }
        
        .certificate-id {
            font-family: 'Courier New', monospace;
            font-weight: bold;
            color: #000;
            font-size: 1.1rem;
            margin-top: 10px;
            text-align: center;
        }
        
        .button-group {
            display: flex;
            gap: 15px;
            margin-top: 30px;
            flex-wrap: wrap;
        }
        
        .btn {
            padding: 14px 28px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1.1rem;
            font-weight: 600;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 10px;
            font-family: 'Montserrat', sans-serif;
        }
        
        .btn i {
            font-size: 1.2rem;
        }
        
        .btn-primary {
            background: linear-gradient(to right, var(--secondary), #2980b9);
            color: white;
        }
        
        .btn-primary:hover {
            background: linear-gradient(to right, #2980b9, #2573a7);
            transform: translateY(-3px);
            box-shadow: 0 7px 15px rgba(0,0,0,0.1);
        }
        
        .btn-success {
            background: linear-gradient(to right, var(--success), #219653);
            color: white;
        }
        
        .btn-success:hover {
            background: linear-gradient(to right, #219653, #1e8449);
            transform: translateY(-3px);
            box-shadow: 0 7px 15px rgba(0,0,0,0.1);
        }
        
        .btn-secondary {
            background: linear-gradient(to right, #95a5a6, #7f8c8d);
            color: white;
        }
        
        .btn-secondary:hover {
            background: linear-gradient(to right, #7f8c8d, #6c7a7b);
            transform: translateY(-3px);
            box-shadow: 0 7px 15px rgba(0,0,0,0.1);
        }
        
        .btn-warning {
            background: linear-gradient(to right, #e67e22, #d35400);
            color: white;
        }
        
        .btn-warning:hover {
            background: linear-gradient(to right, #d35400, #c0392b);
            transform: translateY(-3px);
            box-shadow: 0 7px 15px rgba(0,0,0,0.1);
        }
        
        .preview-controls {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 25px;
        }
        
        .status-message {
            padding: 12px 15px;
            border-radius: 8px;
            margin-top: 20px;
            display: none;
            text-align: center;
        }
        
        .success-message {
            background-color: #d4edda;
            color: #155724;
            display: block;
        }
        
        .error-message {
            background-color: #f8d7da;
            color: #721c24;
            display: block;
        }
        
        .info-message {
            background-color: #d1ecf1;
            color: #0c5460;
            display: block;
        }
        
        .verify-container {
            max-width: 800px;
            margin: 0 auto;
            padding: 30px;
            background: white;
            border-radius: 15px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
        }
        
        .verify-options {
            display: flex;
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .verify-option {
            flex: 1;
            padding: 20px;
            border: 2px solid var(--secondary);
            border-radius: 10px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .verify-option:hover {
            background: rgba(52, 152, 219, 0.1);
        }
        
        .verify-option i {
            font-size: 3rem;
            color: var(--secondary);
            margin-bottom: 15px;
        }
        
        .verify-section {
            display: none;
        }
        
        .verify-section.active {
            display: block;
        }
        
        .qr-scanner {
            width: 100%;
            height: 400px;
            background: #f0f0f0;
            border-radius: 10px;
            margin-bottom: 20px;
            display: flex;
            justify-content: center;
            align-items: center;
            flex-direction: column;
        }
        
        .manual-input {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }
        
        .manual-input input {
            flex: 1;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
        }
        
        .verify-result {
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
            margin-top: 20px;
            display: none;
        }
        
        .password-prompt {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            display: none;
        }
        
        .password-box {
            background: white;
            padding: 30px;
            border-radius: 15px;
            width: 400px;
            max-width: 90%;
            text-align: center;
        }
        
        .password-box input {
            width: 100%;
            padding: 12px;
            margin: 20px 0;
            border: 2px solid #ddd;
            border-radius: 8px;
        }
        
        .progress-container {
            width: 100%;
            background-color: #f0f0f0;
            border-radius: 8px;
            margin: 15px 0;
            display: none;
        }
        
        .progress-bar {
            width: 0%;
            height: 20px;
            background-color: var(--secondary);
            border-radius: 8px;
            text-align: center;
            line-height: 20px;
            color: white;
            font-weight: bold;
            transition: width 0.4s ease;
        }
        
        /* Style controls */
        .style-controls {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }
        
        .style-group {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }
        
        .layout-controls {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }
        
        .alignment-controls {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }
        
        .alignment-btn {
            flex: 1;
            padding: 10px;
            border: 2px solid #ddd;
            border-radius: 8px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 1.2rem;
            background: #f8f9fa;
        }
        
        .alignment-btn:hover, .alignment-btn.active {
            border-color: var(--secondary);
            background: rgba(52, 152, 219, 0.1);
        }
        
        @media (max-width: 1100px) {
            .app-container {
                flex-direction: column;
            }
            
            .design-panel {
                flex: 0 0 auto;
            }
            
            .certificate {
                height: 400px;
            }
        }
        
        @media (max-width: 768px) {
            .certificate-title {
                font-size: 2.5rem;
            }
            
            .certificate-type {
                font-size: 1.4rem;
            }
            
            .certificate-name {
                font-size: 2rem;
            }
            
            .certificate-text {
                font-size: 1rem;
            }
            
            .btn {
                padding: 12px 20px;
                font-size: 1rem;
            }
            
            .certificate {
                transform: scale(0.8);
                transform-origin: top center;
            }
            
            .style-controls {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1><i class="fas fa-certificate"></i> Advanced Certificate Generator</h1>
            <p>Create fully customizable certificates with drag-and-drop positioning</p>
        </header>

        <div class="tabs">
            <button class="tab-btn active" data-tab="generate">Generate Certificate</button>
            <button class="tab-btn" data-tab="verify">Verify Certificate</button>
        </div>
        
        <div id="generate-tab" class="tab-content active">
            <div class="app-container">
                <div class="design-panel">
                    <h2 class="panel-title">Design Settings</h2>
                    
                    <div class="form-section">
                        <h3><i class="fas fa-image"></i> Background & Orientation</h3>
                        
                        <div class="orientation-selector">
                            <div class="orientation-btn active" data-orientation="portrait">
                                <i class="fas fa-portrait"></i> Portrait
                            </div>
                            <div class="orientation-btn" data-orientation="landscape">
                                <i class="fas fa-landscape"></i> Landscape
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label>Background Image (A4 Size)</label>
                            <div class="upload-control">
                                <label for="backgroundUpload" class="file-upload-label">
                                    <i class="fas fa-file-image"></i> Choose
                                </label>
                                <input type="file" id="backgroundUpload" accept="image/*">
                                <span id="backgroundFileName" class="file-name">None</span>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label>Left Logo</label>
                            <div class="upload-control">
                                <label for="leftLogoUpload" class="file-upload-label">
                                    <i class="fas fa-file-image"></i> Choose
                                </label>
                                <input type="file" id="leftLogoUpload" accept="image/*">
                                <span id="leftLogoFileName" class="file-name">None</span>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label>Right Logo</label>
                            <div class="upload-control">
                                <label for="rightLogoUpload" class="file-upload-label">
                                    <i class="fas fa-file-image"></i> Choose
                                </label>
                                <input type="file" id="rightLogoUpload" accept="image/*">
                                <span id="rightLogoFileName" class="file-name">None</span>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label>Watermark Image</label>
                            <div class="upload-control">
                                <label for="watermarkUpload" class="file-upload-label">
                                    <i class="fas fa-water"></i> Choose
                                </label>
                                <input type="file" id="watermarkUpload" accept="image/*">
                                <span id="watermarkFileName" class="file-name">None</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-section">
                        <h3><i class="fas fa-text-height"></i> Content</h3>
                        
                        <div class="form-group">
                            <label for="certificateTitle">Main Title</label>
                            <input type="text" id="certificateTitle" value="CERTIFICATE">
                        </div>
                        
                        <div class="form-group">
                            <label for="certificateType">Certificate Type</label>
                            <input type="text" id="certificateType" value="OF EXCELLENCE">
                        </div>
                        
                        <div class="form-group">
                            <label for="presentedText">Presented Text</label>
                            <input type="text" id="presentedText" value="This certificate is proudly presented to">
                        </div>
                        
                        <div class="form-group">
                            <label for="recipientName">Recipient Name</label>
                            <input type="text" id="recipientName" value="John Smith">
                        </div>
                        
                        <div class="form-group">
                            <label for="certificateText">Certificate Text</label>
                            <textarea id="certificateText">for outstanding achievement and exceptional performance in the Advanced Web Development program. Your dedication and hard work have set a remarkable example for others to follow.</textarea>
                        </div>
                        
                        <div class="form-group">
                            <label for="certificateDate">Date</label>
                            <input type="date" id="certificateDate">
                        </div>
                        
                        <div class="form-group">
                            <label for="certificateVenue">Venue</label>
                            <input type="text" id="certificateVenue" value="Online">
                        </div>
                    </div>
                    
                    <div class="form-section">
                        <h3><i class="fas fa-font"></i> Element Styling</h3>
                        
                        <div class="form-group">
                            <label for="elementSelector">Select Element</label>
                            <select id="elementSelector">
                                <option value="title">Main Title</option>
                                <option value="type">Certificate Type</option>
                                <option value="presented">Presented Text</option>
                                <option value="recipient">Recipient Name</option>
                                <option value="body">Certificate Text</option>
                                <option value="date">Date</option>
                                <option value="venue">Venue</option>
                                <option value="signature1">Signature 1</option>
                                <option value="signature2">Signature 2</option>
                                <option value="qr">QR Code</option>
                            </select>
                        </div>
                        
                        <div class="style-controls">
                            <div class="style-group">
                                <label for="elementFont">Font Family</label>
                                <select id="elementFont">
                                    <option value="'Times New Roman', serif">Times New Roman</option>
                                    <option value="Arial, sans-serif">Arial</option>
                                    <option value="'Courier New', monospace">Courier New</option>
                                    <option value="Georgia, serif">Georgia</option>
                                    <option value="'Montserrat', sans-serif">Montserrat</option>
                                    <option value="'Playfair Display', serif">Playfair Display</option>
                                </select>
                            </div>
                            
                            <div class="style-group">
                                <label for="elementSize">Font Size (px)</label>
                                <input type="number" id="elementSize" value="24" min="8" max="100">
                            </div>
                            
                            <div class="style-group">
                                <label for="elementColor">Text Color</label>
                                <input type="color" id="elementColor" value="#000000">
                            </div>
                            
                            <div class="style-group">
                                <label for="elementWeight">Font Weight</label>
                                <select id="elementWeight">
                                    <option value="normal">Normal</option>
                                    <option value="bold">Bold</option>
                                    <option value="600">Semi-Bold</option>
                                    <option value="800">Extra Bold</option>
                                </select>
                            </div>
                            
                            <div class="style-group">
                                <label for="elementStyle">Font Style</label>
                                <select id="elementStyle">
                                    <option value="normal">Normal</option>
                                    <option value="italic">Italic</option>
                                </select>
                            </div>
                            
                            <div class="style-group">
                                <label for="elementDecoration">Text Decoration</label>
                                <select id="elementDecoration">
                                    <option value="none">None</option>
                                    <option value="underline">Underline</option>
                                    <option value="overline">Overline</option>
                                    <option value="line-through">Line Through</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label>Text Alignment</label>
                            <div class="alignment-controls">
                                <div class="alignment-btn" data-align="left" title="Align Left">
                                    <i class="fas fa-align-left"></i>
                                </div>
                                <div class="alignment-btn" data-align="center" title="Align Center">
                                    <i class="fas fa-align-center"></i>
                                </div>
                                <div class="alignment-btn" data-align="right" title="Align Right">
                                    <i class="fas fa-align-right"></i>
                                </div>
                                <div class="alignment-btn" data-align="justify" title="Justify">
                                    <i class="fas fa-align-justify"></i>
                                </div>
                            </div>
                        </div>
                        
                        <div class="form-group" id="nameDesignContainer">
                            <label>Name Design Options</label>
                            <div class="style-controls">
                                <div class="style-group">
                                    <label for="nameDecoration">Decoration</label>
                                    <select id="nameDecoration">
                                        <option value="none">None</option>
                                        <option value="double">Double Line</option>
                                        <option value="stars">Stars</option>
                                        <option value="underline">Underline</option>
                                    </select>
                                </div>
                                <div class="style-group">
                                    <label for="nameColor">Decoration Color</label>
                                    <input type="color" id="nameColor" value="#d4af37">
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-section">
                        <h3><i class="fas fa-signature"></i> Signatures</h3>
                        
                        <div class="form-group">
                            <label>Signature 1</label>
                            <div class="upload-control">
                                <label for="signature1Upload" class="file-upload-label">
                                    <i class="fas fa-file-image"></i> Choose
                                </label>
                                <input type="file" id="signature1Upload" accept="image/*">
                                <span id="signature1FileName" class="file-name">None</span>
                            </div>
                            <input type="text" id="signature1Name" placeholder="Name" value="Sarah Johnson">
                            <input type="text" id="signature1Title" placeholder="Title" value="Director of Education">
                        </div>
                        
                        <div class="form-group">
                            <label>Signature 2</label>
                            <div class="upload-control">
                                <label for="signature2Upload" class="file-upload-label">
                                    <i class="fas fa-file-image"></i> Choose
                                </label>
                                <input type="file" id="signature2Upload" accept="image/*">
                                <span id="signature2FileName" class="file-name">None</span>
                            </div>
                            <input type="text" id="signature2Name" placeholder="Name" value="Michael Chen">
                            <input type="text" id="signature2Title" placeholder="Title" value="Program Coordinator">
                        </div>
                    </div>
                    
                    <div class="form-section">
                        <h3><i class="fas fa-file-csv"></i> Bulk Generation</h3>
                        
                        <div class="form-group">
                            <label>Upload CSV File</label>
                            <div class="upload-control">
                                <label for="csvUpload" class="file-upload-label">
                                    <i class="fas fa-file-csv"></i> Choose CSV
                                </label>
                                <input type="file" id="csvUpload" accept=".csv">
                                <span id="csvFileName" class="file-name">None</span>
                            </div>
                            <div id="csvInfo" class="status-message info-message" style="display: none;">
                                CSV loaded: <span id="csvCount">0</span> records found
                            </div>
                        </div>
                        
                        <div class="progress-container" id="progressContainer">
                            <div class="progress-bar" id="progressBar">0%</div>
                        </div>
                        
                        <button class="btn btn-warning" id="generateAllBtn">
                            <i class="fas fa-bolt"></i> Generate All Certificates
                        </button>
                    </div>
                    
                    <div class="button-group">
                        <button class="btn btn-success" id="downloadBtn">
                            <i class="fas fa-download"></i> Download Certificate
                        </button>
                        <button class="btn btn-primary" id="updatePreviewBtn">
                            <i class="fas fa-sync"></i> Update Preview
                        </button>
                    </div>
                    
                    <div class="layout-controls">
                        <button class="btn btn-secondary" id="saveLayoutBtn">
                            <i class="fas fa-save"></i> Save Layout
                        </button>
                        <button class="btn btn-secondary" id="resetLayoutBtn">
                            <i class="fas fa-undo"></i> Reset Layout
                        </button>
                    </div>
                    
                    <div id="statusMessage" class="status-message"></div>
                </div>
                
                <div class="preview-panel">
                    <div class="preview-container">
                        <div class="preview-header">
                            <h2 class="panel-title">Certificate Preview</h2>
                            <div class="layout-controls">
                                <button class="btn btn-secondary" id="enableDragBtn">
                                    <i class="fas fa-hand-pointer"></i> Move Elements
                                </button>
                            </div>
                        </div>
                        
                        <div class="certificate-wrapper">
                            <div class="certificate" id="certificatePreview">
                                <!-- Watermark as a direct child of certificate -->
                                <div id="draggable-watermark" class="draggable" style="top: 50%; left: 50%; transform: translate(-50%, -50%);">
                                    <img id="previewWatermark" class="watermark" src="" alt="Watermark">
                                </div>
                                
                                <div class="certificate-content" id="certificateContent">
                                    <!-- Left Logo (separate draggable element) -->
                                    <div id="draggable-left-logo" class="draggable" style="top: 80px; left: 100px;">
                                        <img src="" alt="Left Logo" class="logo" id="leftLogoPreview">
                                    </div>
                                    
                                    <!-- Title Container (without logos) -->
                                    <div id="draggable-title" class="draggable" style="top: 100px; left: 50%; transform: translateX(-50%);">
                                        <div class="title-container">
                                            <div class="certificate-title" id="previewTitle">CERTIFICATE</div>
                                            <div class="certificate-type" id="previewType">OF EXCELLENCE</div>
                                        </div>
                                    </div>
                                    
                                    <!-- Right Logo (separate draggable element) -->
                                    <div id="draggable-right-logo" class="draggable" style="top: 80px; right: 100px;">
                                        <img src="" alt="Right Logo" class="logo" id="rightLogoPreview">
                                    </div>
                                    
                                    <!-- Recipient -->
                                    <div id="draggable-recipient" class="draggable" style="top: 300px; left: 50%; transform: translateX(-50%);">
                                        <p class="certificate-presented" id="previewPresented">This certificate is proudly presented to</p>
                                        <div class="certificate-name" id="previewRecipient">John Smith</div>
                                    </div>
                                    
                                    <!-- Certificate Text -->
                                    <div id="draggable-text" class="draggable" style="top: 450px; left: 50%; transform: translateX(-50%);">
                                        <p class="certificate-text" id="previewText">for outstanding achievement and exceptional performance in the Advanced Web Development program. Your dedication and hard work have set a remarkable example for others to follow.</p>
                                    </div>
                                    
                                    <!-- Details -->
                                    <div id="draggable-details" class="draggable" style="top: 600px; left: 50%; transform: translateX(-50%);">
                                        <div class="certificate-details">
                                            <span id="previewDate">Date: August 16, 2025</span>
                                            <span id="previewVenue">Venue: Online</span>
                                        </div>
                                    </div>
                                    
                                    <!-- Signatures -->
                                    <div id="draggable-signatures" class="draggable" style="top: 700px; left: 50%; transform: translateX(-50%);">
                                        <div class="signatures">
                                            <div class="signature">
                                                <img src="" class="signature-image" id="previewSignature1">
                                                <div class="signature-line"></div>
                                                <div class="signature-name">Sarah Johnson</div>
                                                <div class="signature-title">Director of Education</div>
                                            </div>
                                            
                                            <div class="qr-container">
                                                <div class="qr-code" id="previewQrCode"></div>
                                                <div class="certificate-id" id="previewCertId">CERT-20250816-001</div>
                                            </div>
                                            
                                            <div class="signature">
                                                <img src="" class="signature-image" id="previewSignature2">
                                                <div class="signature-line"></div>
                                                <div class="signature-name">Michael Chen</div>
                                                <div class="signature-title">Program Coordinator</div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="preview-controls">
                            <button class="btn btn-secondary" id="printBtn">
                                <i class="fas fa-print"></i> Print Certificate
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div id="verify-tab" class="tab-content">
            <div class="verify-container">
                <h2 class="panel-title">Verify Certificate</h2>
                
                <div class="verify-options">
                    <div class="verify-option" id="scannerOption">
                        <i class="fas fa-qrcode"></i>
                        <h3>Scan QR Code</h3>
                        <p>Use your camera to scan the certificate QR code</p>
                    </div>
                    <div class="verify-option" id="manualOption">
                        <i class="fas fa-keyboard"></i>
                        <h3>Enter Certificate ID</h3>
                        <p>Manually enter the certificate ID</p>
                    </div>
                </div>
                
                <div class="verify-section" id="scannerSection">
                    <div class="qr-scanner" id="qrScanner">
                        <i class="fas fa-camera fa-3x"></i>
                        <p>Camera access required for scanning</p>
                        <button class="btn btn-primary" id="startScanBtn">Start Scanning</button>
                    </div>
                </div>
                
                <div class="verify-section" id="manualSection">
                    <div class="manual-input">
                        <input type="text" id="certificateIdInput" placeholder="Enter Certificate ID">
                        <button class="btn btn-primary" id="verifyBtn">Verify</button>
                    </div>
                </div>
                
                <div class="verify-result" id="verifyResult">
                    <h3>Certificate Verification</h3>
                    <div id="verificationDetails"></div>
                </div>
            </div>
        </div>
    </div>
    
    <div class="password-prompt" id="passwordPrompt">
        <div class="password-box">
            <h3>Admin Access Required</h3>
            <p>Please enter the password to generate certificates</p>
            <input type="password" id="passwordInput" placeholder="Enter password">
            <button class="btn btn-primary" id="submitPassword">Submit</button>
        </div>
    </div>

    <script>
        // Initialize with current date
        document.getElementById('certificateDate').valueAsDate = new Date();
        
        // Global variables
        let backgroundImage = null;
        let leftLogo = null;
        let rightLogo = null;
        let watermarkImage = null;
        let signature1 = null;
        let signature2 = null;
        let orientation = 'portrait';
        let generatedCertificates = {};
        let currentCertificateId = '';
        let isAuthenticated = false;
        let csvData = [];
        let dragEnabled = false;
        let isDragging = false;
        let currentDraggable = null;
        let dragOffsetX, dragOffsetY;
        let savedLayout = null;
        let savedStyles = {};
        let currentAlignment = 'center'; // Default alignment
        
        // DOM elements
        const certificatePreview = document.getElementById('certificatePreview');
        const certificateContent = document.getElementById('certificateContent');
        const leftLogoPreview = document.getElementById('leftLogoPreview');
        const rightLogoPreview = document.getElementById('rightLogoPreview');
        const signature1Preview = document.getElementById('previewSignature1');
        const signature2Preview = document.getElementById('previewSignature2');
        const passwordPrompt = document.getElementById('passwordPrompt');
        
        // Draggable elements
        const draggableElements = {
            'watermark': document.getElementById('draggable-watermark'),
            'left-logo': document.getElementById('draggable-left-logo'),
            'title': document.getElementById('draggable-title'),
            'right-logo': document.getElementById('draggable-right-logo'),
            'recipient': document.getElementById('draggable-recipient'),
            'text': document.getElementById('draggable-text'),
            'details': document.getElementById('draggable-details'),
            'signatures': document.getElementById('draggable-signatures')
        };
        
        // Input elements
        const backgroundUpload = document.getElementById('backgroundUpload');
        const leftLogoUpload = document.getElementById('leftLogoUpload');
        const rightLogoUpload = document.getElementById('rightLogoUpload');
        const watermarkUpload = document.getElementById('watermarkUpload');
        const signature1Upload = document.getElementById('signature1Upload');
        const signature2Upload = document.getElementById('signature2Upload');
        const certificateTitle = document.getElementById('certificateTitle');
        const certificateType = document.getElementById('certificateType');
        const presentedText = document.getElementById('presentedText');
        const recipientName = document.getElementById('recipientName');
        const certificateText = document.getElementById('certificateText');
        const certificateDate = document.getElementById('certificateDate');
        const certificateVenue = document.getElementById('certificateVenue');
        const elementSelector = document.getElementById('elementSelector');
        const elementFont = document.getElementById('elementFont');
        const elementSize = document.getElementById('elementSize');
        const elementColor = document.getElementById('elementColor');
        const elementWeight = document.getElementById('elementWeight');
        const elementStyle = document.getElementById('elementStyle');
        const elementDecoration = document.getElementById('elementDecoration');
        const nameDecoration = document.getElementById('nameDecoration');
        const nameColor = document.getElementById('nameColor');
        const signature1Name = document.getElementById('signature1Name');
        const signature1Title = document.getElementById('signature1Title');
        const signature2Name = document.getElementById('signature2Name');
        const signature2Title = document.getElementById('signature2Title');
        const csvUpload = document.getElementById('csvUpload');
        const csvInfo = document.getElementById('csvInfo');
        const csvCount = document.getElementById('csvCount');
        const progressContainer = document.getElementById('progressContainer');
        const progressBar = document.getElementById('progressBar');
        const alignmentButtons = document.querySelectorAll('.alignment-btn');
        
        // Preview elements
        const previewTitle = document.getElementById('previewTitle');
        const previewType = document.getElementById('previewType');
        const previewPresented = document.getElementById('previewPresented');
        const previewRecipient = document.getElementById('previewRecipient');
        const previewText = document.getElementById('previewText');
        const previewDate = document.getElementById('previewDate');
        const previewVenue = document.getElementById('previewVenue');
        const previewWatermark = document.getElementById('previewWatermark');
        const previewQrCode = document.getElementById('previewQrCode');
        const previewCertId = document.getElementById('previewCertId');
        
        // Buttons
        const downloadBtn = document.getElementById('downloadBtn');
        const updatePreviewBtn = document.getElementById('updatePreviewBtn');
        const printBtn = document.getElementById('printBtn');
        const startScanBtn = document.getElementById('startScanBtn');
        const verifyBtn = document.getElementById('verifyBtn');
        const submitPassword = document.getElementById('submitPassword');
        const generateAllBtn = document.getElementById('generateAllBtn');
        const saveLayoutBtn = document.getElementById('saveLayoutBtn');
        const resetLayoutBtn = document.getElementById('resetLayoutBtn');
        const enableDragBtn = document.getElementById('enableDragBtn');
        
        // Tab functionality
        document.querySelectorAll('.tab-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                const tab = this.dataset.tab;
                
                // Require password only for generate tab
                if (tab === 'generate' && !isAuthenticated) {
                    passwordPrompt.style.display = 'flex';
                    return; // Stop here until authenticated
                }
                
                // Switch tabs
                document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
                document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
                
                this.classList.add('active');
                document.getElementById(`${tab}-tab`).classList.add('active');
            });
        });
        
        // Verify options
        document.getElementById('scannerOption').addEventListener('click', function() {
            document.querySelectorAll('.verify-section').forEach(s => s.classList.remove('active'));
            document.getElementById('scannerSection').classList.add('active');
        });
        
        document.getElementById('manualOption').addEventListener('click', function() {
            document.querySelectorAll('.verify-section').forEach(s => s.classList.remove('active'));
            document.getElementById('manualSection').classList.add('active');
        });
        
        // Password protection
        submitPassword.addEventListener('click', function() {
            const password = document.getElementById('passwordInput').value;
            if (password === 'admin123') {
                passwordPrompt.style.display = 'none';
                isAuthenticated = true;
                
                // Switch to generate tab after authentication
                document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
                document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
                
                document.querySelector('.tab-btn[data-tab="generate"]').classList.add('active');
                document.getElementById('generate-tab').classList.add('active');
            } else {
                alert('Incorrect password. Please try again.');
            }
        });
        
        // Initialize the app
        updatePreview();
        generateQRCode();
        setupDragAndDrop();
        loadLayout();
        loadStyles();
        
        // Event listeners
        backgroundUpload.addEventListener('change', handleBackgroundUpload);
        leftLogoUpload.addEventListener('change', handleLeftLogoUpload);
        rightLogoUpload.addEventListener('change', handleRightLogoUpload);
        watermarkUpload.addEventListener('change', handleWatermarkUpload);
        signature1Upload.addEventListener('change', handleSignature1Upload);
        signature2Upload.addEventListener('change', handleSignature2Upload);
        csvUpload.addEventListener('change', handleCsvUpload);
        
        certificateTitle.addEventListener('input', updatePreview);
        certificateType.addEventListener('input', updatePreview);
        presentedText.addEventListener('input', updatePreview);
        recipientName.addEventListener('input', updatePreview);
        certificateText.addEventListener('input', updatePreview);
        certificateDate.addEventListener('change', updatePreview);
        certificateVenue.addEventListener('input', updatePreview);
        signature1Name.addEventListener('input', updatePreview);
        signature1Title.addEventListener('input', updatePreview);
        signature2Name.addEventListener('input', updatePreview);
        signature2Title.addEventListener('input', updatePreview);
        
        elementSelector.addEventListener('change', updateElementSelector);
        elementFont.addEventListener('change', applyElementStyle);
        elementSize.addEventListener('input', applyElementStyle);
        elementColor.addEventListener('change', applyElementStyle);
        elementWeight.addEventListener('change', applyElementStyle);
        elementStyle.addEventListener('change', applyElementStyle);
        elementDecoration.addEventListener('change', applyElementStyle);
        nameDecoration.addEventListener('change', applyNameDecoration);
        nameColor.addEventListener('change', applyNameDecoration);
        
        downloadBtn.addEventListener('click', downloadCertificate);
        updatePreviewBtn.addEventListener('click', updatePreview);
        printBtn.addEventListener('click', printCertificate);
        verifyBtn.addEventListener('click', verifyCertificate);
        generateAllBtn.addEventListener('click', generateAllCertificates);
        saveLayoutBtn.addEventListener('click', saveLayout);
        resetLayoutBtn.addEventListener('click', resetLayout);
        enableDragBtn.addEventListener('click', toggleDragMode);
        
        // Orientation buttons
        document.querySelectorAll('.orientation-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                document.querySelectorAll('.orientation-btn').forEach(b => {
                    b.classList.remove('active');
                });
                this.classList.add('active');
                orientation = this.dataset.orientation;
                updateOrientation();
            });
        });
        
        // Alignment buttons
        alignmentButtons.forEach(btn => {
            btn.addEventListener('click', function() {
                alignmentButtons.forEach(b => b.classList.remove('active'));
                this.classList.add('active');
                currentAlignment = this.dataset.align;
                applyElementStyle();
            });
        });
        
        // Functions
        function handleBackgroundUpload(e) {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(event) {
                    backgroundImage = event.target.result;
                    document.getElementById('backgroundFileName').textContent = file.name;
                    updatePreview();
                };
                reader.readAsDataURL(file);
            }
        }
        
        function handleLeftLogoUpload(e) {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(event) {
                    leftLogo = event.target.result;
                    document.getElementById('leftLogoFileName').textContent = file.name;
                    updatePreview();
                };
                reader.readAsDataURL(file);
            }
        }
        
        function handleRightLogoUpload(e) {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(event) {
                    rightLogo = event.target.result;
                    document.getElementById('rightLogoFileName').textContent = file.name;
                    updatePreview();
                };
                reader.readAsDataURL(file);
            }
        }
        
        function handleWatermarkUpload(e) {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(event) {
                    watermarkImage = event.target.result;
                    document.getElementById('watermarkFileName').textContent = file.name;
                    updatePreview();
                };
                reader.readAsDataURL(file);
            }
        }
        
        function handleSignature1Upload(e) {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(event) {
                    signature1 = event.target.result;
                    document.getElementById('signature1FileName').textContent = file.name;
                    updatePreview();
                };
                reader.readAsDataURL(file);
            }
        }
        
        function handleSignature2Upload(e) {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(event) {
                    signature2 = event.target.result;
                    document.getElementById('signature2FileName').textContent = file.name;
                    updatePreview();
                };
                reader.readAsDataURL(file);
            }
        }
        
        function handleCsvUpload(e) {
            const file = e.target.files[0];
            if (file) {
                document.getElementById('csvFileName').textContent = file.name;
                Papa.parse(file, {
                    header: true,
                    skipEmptyLines: true,
                    complete: function(results) {
                        if (results.data.length > 0) {
                            csvData = results.data;
                            csvCount.textContent = csvData.length;
                            csvInfo.style.display = 'block';
                            
                            // Update preview with first record
                            const firstRecord = csvData[0];
                            if (firstRecord.recipientName) recipientName.value = firstRecord.recipientName;
                            if (firstRecord.certificateText) certificateText.value = firstRecord.certificateText;
                            if (firstRecord.certificateDate) certificateDate.value = firstRecord.certificateDate;
                            if (firstRecord.certificateVenue) certificateVenue.value = firstRecord.certificateVenue;
                            
                            updatePreview();
                        }
                    }
                });
            }
        }
        
        function updateOrientation() {
            if (orientation === 'landscape') {
                certificatePreview.classList.add('landscape');
            } else {
                certificatePreview.classList.remove('landscape');
            }
        }
        
        function generateQRCode() {
            previewQrCode.innerHTML = '';
            const randomNum = Math.floor(1000 + Math.random() * 9000);
            currentCertificateId = `CERT-${formatDate(new Date())}-${randomNum}`;
            previewCertId.textContent = currentCertificateId;
            
            const qr = new QRCode(previewQrCode, {
                text: `Certificate ID: ${currentCertificateId}\nVerified by Certificate Generator`,
                width: 100,
                height: 100,
                colorDark: "#000000",
                colorLight: "transparent",
                correctLevel: QRCode.CorrectLevel.H
            });
        }
        
        function updatePreview() {
            // Update certificate content
            previewTitle.textContent = certificateTitle.value;
            previewType.textContent = certificateType.value;
            previewPresented.textContent = presentedText.value;
            previewRecipient.textContent = recipientName.value;
            previewText.textContent = certificateText.value;
            
            // Format date
            const date = new Date(certificateDate.value);
            previewDate.textContent = `Date: ${date.toLocaleDateString('en-US', { 
                year: 'numeric', 
                month: 'long', 
                day: 'numeric' 
            })}`;
            
            previewVenue.textContent = `Venue: ${certificateVenue.value}`;
            
            // Update background
            if (backgroundImage) {
                certificatePreview.style.backgroundImage = `url(${backgroundImage})`;
            } else {
                certificatePreview.style.backgroundImage = 'none';
            }
            
            // Update logos
            if (leftLogo) {
                leftLogoPreview.src = leftLogo;
                leftLogoPreview.style.display = 'block';
            } else {
                leftLogoPreview.style.display = 'none';
            }
            
            if (rightLogo) {
                rightLogoPreview.src = rightLogo;
                rightLogoPreview.style.display = 'block';
            } else {
                rightLogoPreview.style.display = 'none';
            }
            
            // Update watermark
            if (watermarkImage) {
                previewWatermark.src = watermarkImage;
                previewWatermark.style.display = 'block';
            } else {
                previewWatermark.style.display = 'none';
            }
            
            // Update signatures
            if (signature1) {
                signature1Preview.src = signature1;
                signature1Preview.style.display = 'block';
            } else {
                signature1Preview.style.display = 'none';
            }
            
            if (signature2) {
                signature2Preview.src = signature2;
                signature2Preview.style.display = 'block';
            } else {
                signature2Preview.style.display = 'none';
            }
            
            // Update signature names
            document.querySelectorAll('.signature-name')[0].textContent = signature1Name.value;
            document.querySelectorAll('.signature-title')[0].textContent = signature1Title.value;
            document.querySelectorAll('.signature-name')[1].textContent = signature2Name.value;
            document.querySelectorAll('.signature-title')[1].textContent = signature2Title.value;
            
            // Apply saved styles
            applyAllStyles();
        }
        
        function updateElementSelector() {
            const element = elementSelector.value;
            // Populate controls with saved values if available
            const style = savedStyles[element] || {};
            
            elementFont.value = style.fontFamily || "'Times New Roman', serif";
            elementSize.value = style.fontSize || 24;
            elementColor.value = style.color || "#000000";
            elementWeight.value = style.fontWeight || "normal";
            elementStyle.value = style.fontStyle || "normal";
            elementDecoration.value = style.textDecoration || "none";
            
            // Set alignment
            currentAlignment = style.textAlign || "center";
            alignmentButtons.forEach(btn => {
                btn.classList.remove('active');
                if (btn.dataset.align === currentAlignment) {
                    btn.classList.add('active');
                }
            });
            
            // Show/hide name design options
            document.getElementById('nameDesignContainer').style.display = 
                element === 'recipient' ? 'block' : 'none';
        }
        
        function applyElementStyle() {
            const element = elementSelector.value;
            const style = {
                fontFamily: elementFont.value,
                fontSize: `${elementSize.value}px`,
                color: elementColor.value,
                fontWeight: elementWeight.value,
                fontStyle: elementStyle.value,
                textDecoration: elementDecoration.value,
                textAlign: currentAlignment
            };
            
            savedStyles[element] = style;
            applyStyleToElement(element, style);
            saveStyles();
        }
        
        function applyNameDecoration() {
            const element = 'recipient';
            const style = savedStyles[element] || {};
            
            style.nameDecoration = nameDecoration.value;
            style.nameColor = nameColor.value;
            
            savedStyles[element] = style;
            applyStyleToElement(element, style);
            saveStyles();
        }
        
        function applyStyleToElement(element, style) {
            let targetElement;
            
            switch(element) {
                case 'title':
                    targetElement = previewTitle;
                    break;
                case 'type':
                    targetElement = previewType;
                    break;
                case 'presented':
                    targetElement = previewPresented;
                    break;
                case 'recipient':
                    targetElement = previewRecipient;
                    break;
                case 'body':
                    targetElement = previewText;
                    break;
                case 'date':
                    targetElement = previewDate;
                    break;
                case 'venue':
                    targetElement = previewVenue;
                    break;
                case 'signature1':
                    targetElement = document.querySelector('.signature-name');
                    break;
                case 'signature2':
                    targetElement = document.querySelectorAll('.signature-name')[1];
                    break;
                case 'qr':
                    targetElement = previewCertId;
                    break;
            }
            
            if (targetElement) {
                targetElement.style.fontFamily = style.fontFamily;
                targetElement.style.fontSize = style.fontSize;
                targetElement.style.color = style.color;
                targetElement.style.fontWeight = style.fontWeight;
                targetElement.style.fontStyle = style.fontStyle;
                targetElement.style.textDecoration = style.textDecoration;
                targetElement.style.textAlign = style.textAlign;
                
                // Apply name decoration if it's the recipient
                if (element === 'recipient') {
                    applyNameDecorationStyle(targetElement, style);
                }
            }
        }
        
        function applyNameDecorationStyle(element, style) {
            // Remove existing decorations
            element.classList.remove('double', 'stars', 'underline');
            
            // Apply new decoration
            if (style.nameDecoration) {
                element.classList.add(style.nameDecoration);
            }
            
            // Set color
            if (style.nameColor) {
                element.style.setProperty('--decoration-color', style.nameColor);
            }
        }
        
        function applyAllStyles() {
            Object.keys(savedStyles).forEach(element => {
                applyStyleToElement(element, savedStyles[element]);
            });
        }
        
        function downloadCertificate() {
            if (!isAuthenticated) {
                alert('Please authenticate to generate certificates');
                passwordPrompt.style.display = 'flex';
                return;
            }
            
            const downloadBtn = document.getElementById('downloadBtn');
            const originalBtnHTML = downloadBtn.innerHTML;
            downloadBtn.innerHTML = '<div class="loading"></div> Preparing...';
            downloadBtn.disabled = true;
            
            // Temporarily hide controls for capture
            const previewControls = document.querySelector('.preview-controls');
            const originalControlsDisplay = previewControls.style.display;
            previewControls.style.display = 'none';
            
            // Disable drag during capture
            const dragState = dragEnabled;
            if (dragEnabled) toggleDragMode();
            
            setTimeout(() => {
                html2canvas(certificatePreview, {
                    scale: 3,
                    useCORS: true,
                    logging: false,
                    backgroundColor: null
                }).then(canvas => {
                    const link = document.createElement('a');
                    link.download = `Certificate-${recipientName.value.replace(/\s+/g, '_')}.png`;
                    link.href = canvas.toDataURL('image/png');
                    link.click();
                    
                    // Show status message
                    const statusMessage = document.getElementById('statusMessage');
                    statusMessage.className = 'status-message success-message';
                    statusMessage.textContent = 'Certificate downloaded successfully!';
                    
                    // Store certificate data for verification
                    generatedCertificates[currentCertificateId] = {
                        recipient: recipientName.value,
                        date: certificateDate.value,
                        venue: certificateVenue.value,
                        type: certificateType.value
                    };
                    
                    // Restore button state
                    downloadBtn.innerHTML = originalBtnHTML;
                    downloadBtn.disabled = false;
                    
                    // Restore controls
                    previewControls.style.display = originalControlsDisplay;
                    
                    // Restore drag state
                    if (dragState) toggleDragMode();
                    
                    // Hide status message after 3 seconds
                    setTimeout(() => {
                        statusMessage.style.display = 'none';
                    }, 3000);
                }).catch(error => {
                    console.error('Error generating certificate:', error);
                    const statusMessage = document.getElementById('statusMessage');
                    statusMessage.className = 'status-message error-message';
                    statusMessage.textContent = 'Error generating certificate. Please try again.';
                    
                    downloadBtn.innerHTML = originalBtnHTML;
                    downloadBtn.disabled = false;
                    previewControls.style.display = originalControlsDisplay;
                    
                    // Restore drag state
                    if (dragState) toggleDragMode();
                });
            }, 500);
        }
        
        function generateAllCertificates() {
            if (!isAuthenticated) {
                alert('Please authenticate to generate certificates');
                passwordPrompt.style.display = 'flex';
                return;
            }
            
            if (csvData.length === 0) {
                alert('Please upload a CSV file first');
                return;
            }
            
            const generateAllBtn = document.getElementById('generateAllBtn');
            const originalBtnHTML = generateAllBtn.innerHTML;
            generateAllBtn.innerHTML = '<div class="loading"></div> Processing...';
            generateAllBtn.disabled = true;
            
            // Disable drag during bulk generation
            const dragState = dragEnabled;
            if (dragEnabled) toggleDragMode();
            
            progressContainer.style.display = 'block';
            progressBar.style.width = '0%';
            progressBar.textContent = '0%';
            
            const zip = new JSZip();
            const total = csvData.length;
            let processed = 0;
            
            function processNext() {
                if (processed >= total) {
                    // Create ZIP file and download
                    zip.generateAsync({type:"blob"})
                    .then(function(content) {
                        saveAs(content, "certificates.zip");
                        
                        // Update UI
                        generateAllBtn.innerHTML = originalBtnHTML;
                        generateAllBtn.disabled = false;
                        progressContainer.style.display = 'none';
                        
                        // Show success message
                        const statusMessage = document.getElementById('statusMessage');
                        statusMessage.className = 'status-message success-message';
                        statusMessage.textContent = `${total} certificates generated and downloaded as ZIP file!`;
                        
                        setTimeout(() => {
                            statusMessage.style.display = 'none';
                        }, 5000);
                        
                        // Restore drag state
                        if (dragState) toggleDragMode();
                    });
                    return;
                }
                
                const record = csvData[processed];
                processed++;
                
                // Update form with current record
                if (record.recipientName) recipientName.value = firstRecord.recipientName;
                if (record.certificateText) certificateText.value = firstRecord.certificateText;
                if (record.certificateDate) certificateDate.value = firstRecord.certificateDate;
                if (record.certificateVenue) certificateVenue.value = firstRecord.certificateVenue;
                
                // Update preview
                updatePreview();
                
                // Generate certificate ID
                const randomNum = Math.floor(1000 + Math.random() * 9000);
                const certId = `CERT-${formatDate(new Date())}-${randomNum}`;
                previewCertId.textContent = certId;
                
                // Update QR code
                previewQrCode.innerHTML = '';
                const qr = new QRCode(previewQrCode, {
                    text: `Certificate ID: ${certId}\nVerified by Certificate Generator`,
                    width: 100,
                    height: 100,
                    colorDark: "#000000",
                    colorLight: "transparent",
                    correctLevel: QRCode.CorrectLevel.H
                });
                
                // Store certificate data for verification
                generatedCertificates[certId] = {
                    recipient: record.recipientName,
                    date: record.certificateDate,
                    venue: record.certificateVenue,
                    type: certificateType.value
                };
                
                // Apply saved layout
                applyLayout();
                
                // Capture the certificate as image
                setTimeout(() => {
                    html2canvas(certificatePreview, {
                        scale: 3,
                        useCORS: true,
                        logging: false,
                        backgroundColor: null
                    }).then(canvas => {
                        canvas.toBlob(function(blob) {
                            zip.file(`Certificate-${record.recipientName.replace(/\s+/g, '_')}.png`, blob);
                            
                            // Update progress
                            const progress = Math.round((processed / total) * 100);
                            progressBar.style.width = `${progress}%`;
                            progressBar.textContent = `${progress}%`;
                            
                            // Process next
                            setTimeout(processNext, 100);
                        });
                    });
                }, 500);
            }
            
            // Start processing
            processNext();
        }
        
        function printCertificate() {
            const printBtn = document.getElementById('printBtn');
            const originalBtnHTML = printBtn.innerHTML;
            printBtn.innerHTML = '<div class="loading"></div> Preparing...';
            printBtn.disabled = true;
            
            // Temporarily hide controls for printing
            const previewControls = document.querySelector('.preview-controls');
            const originalControlsDisplay = previewControls.style.display;
            previewControls.style.display = 'none';
            
            // Disable drag during print
            const dragState = dragEnabled;
            if (dragEnabled) toggleDragMode();
            
            setTimeout(() => {
                const printWindow = window.open('', '', 'width=1000,height=800');
                printWindow.document.write(`
                    <!DOCTYPE html>
                    <html>
                    <head>
                        <title>Certificate Print</title>
                        <style>
                            body { 
                                margin: 0; 
                                padding: 20px; 
                                background: #f0f0f0;
                                display: flex;
                                justify-content: center;
                                align-items: center;
                                min-height: 100vh;
                            }
                            .certificate-container {
                                max-width: 900px;
                                margin: 0 auto;
                            }
                            .certificate { 
                                width: 100%; 
                                height: auto; 
                                background: white; 
                                box-shadow: 0 10px 30px rgba(0,0,0,0.15);
                                position: relative;
                            }
                            @media print {
                                body { background: white; padding: 0; }
                                .certificate-container { max-width: 100%; }
                                .certificate { box-shadow: none; }
                            }
                        </style>
                    </head>
                    <body>
                        <div class="certificate-container">
                            ${certificatePreview.outerHTML}
                        </div>
                        <script>
                            window.onload = function() {
                                window.print();
                                setTimeout(function() {
                                    window.close();
                                }, 1000);
                            };
                        <\/script>
                    </body>
                    </html>
                `);
                printWindow.document.close();
                
                // Restore button state
                printBtn.innerHTML = originalBtnHTML;
                printBtn.disabled = false;
                
                // Restore controls
                previewControls.style.display = originalControlsDisplay;
                
                // Restore drag state
                if (dragState) toggleDragMode();
            }, 500);
        }
        
        function verifyCertificate() {
            const certId = document.getElementById('certificateIdInput').value;
            const verifyResult = document.getElementById('verifyResult');
            const verificationDetails = document.getElementById('verificationDetails');
            
            if (!certId) {
                verificationDetails.innerHTML = '<p class="error-message">Please enter a certificate ID</p>';
                verifyResult.style.display = 'block';
                return;
            }
            
            if (generatedCertificates[certId]) {
                const cert = generatedCertificates[certId];
                verificationDetails.innerHTML = `
                    <div class="status-message success-message">
                        <i class="fas fa-check-circle"></i> Certificate Verified Successfully!
                    </div>
                    <div class="cert-details">
                        <p><strong>Recipient:</strong> ${cert.recipient}</p>
                        <p><strong>Date:</strong> ${new Date(cert.date).toLocaleDateString()}</p>
                        <p><strong>Venue:</strong> ${cert.venue}</p>
                        <p><strong>Type:</strong> ${cert.type}</p>
                        <p><strong>Certificate ID:</strong> ${certId}</p>
                    </div>
                `;
                verifyResult.style.display = 'block';
            } else {
                verificationDetails.innerHTML = `
                    <div class="status-message error-message">
                        <i class="fas fa-exclamation-triangle"></i> Certificate Not Found!
                    </div>
                    <p>The certificate ID ${certId} was not found in our records.</p>
                `;
                verifyResult.style.display = 'block';
            }
        }
        
        function formatDate(date) {
            const year = date.getFullYear();
            const month = String(date.getMonth() + 1).padStart(2, '0');
            const day = String(date.getDate()).padStart(2, '0');
            return `${year}${month}${day}`;
        }
        
        // Drag and drop functionality
        function setupDragAndDrop() {
            // Add event listeners to all draggable elements
            Object.values(draggableElements).forEach(element => {
                element.addEventListener('mousedown', startDrag);
            });
            
            document.addEventListener('mousemove', drag);
            document.addEventListener('mouseup', endDrag);
        }
        
        function startDrag(e) {
            if (!dragEnabled) return;
            
            isDragging = true;
            currentDraggable = e.target.closest('.draggable');
            if (!currentDraggable) return;
            
            // Calculate offset
            const rect = currentDraggable.getBoundingClientRect();
            dragOffsetX = e.clientX - rect.left;
            dragOffsetY = e.clientY - rect.top;
            
            // Add dragging class
            currentDraggable.classList.add('dragging');
            e.preventDefault();
        }
        
        function drag(e) {
            if (!isDragging || !currentDraggable || !dragEnabled) return;
            
            // Calculate new position
            const containerRect = certificatePreview.getBoundingClientRect();
            const x = e.clientX - containerRect.left - dragOffsetX;
            const y = e.clientY - containerRect.top - dragOffsetY;
            
            // Apply new position
            currentDraggable.style.left = `${x}px`;
            currentDraggable.style.top = `${y}px`;
        }
        
        function endDrag() {
            if (!isDragging) return;
            
            isDragging = false;
            if (currentDraggable) {
                currentDraggable.classList.remove('dragging');
                currentDraggable = null;
            }
        }
        
        function toggleDragMode() {
            dragEnabled = !dragEnabled;
            enableDragBtn.innerHTML = dragEnabled ? 
                '<i class="fas fa-hand-pointer"></i> Save Positions' : 
                '<i class="fas fa-hand-pointer"></i> Move Elements';
            
            // Update cursor style
            Object.values(draggableElements).forEach(element => {
                element.style.cursor = dragEnabled ? 'move' : 'default';
            });
            
            if (!dragEnabled) {
                saveLayout();
            }
        }
        
        function saveLayout() {
            const layout = {};
            
            Object.keys(draggableElements).forEach(key => {
                const element = draggableElements[key];
                layout[key] = {
                    left: element.style.left || 'auto',
                    top: element.style.top || 'auto'
                };
            });
            
            localStorage.setItem('certificateLayout', JSON.stringify(layout));
            savedLayout = layout;
            
            // Show status message
            const statusMessage = document.getElementById('statusMessage');
            statusMessage.className = 'status-message success-message';
            statusMessage.textContent = 'Layout saved successfully!';
            
            setTimeout(() => {
                statusMessage.style.display = 'none';
            }, 3000);
        }
        
        function loadLayout() {
            const saved = localStorage.getItem('certificateLayout');
            if (saved) {
                savedLayout = JSON.parse(saved);
                applyLayout();
            }
        }
        
        function applyLayout() {
            if (!savedLayout) return;
            
            Object.keys(savedLayout).forEach(key => {
                const element = draggableElements[key];
                if (element && savedLayout[key]) {
                    element.style.left = savedLayout[key].left;
                    element.style.top = savedLayout[key].top;
                }
            });
        }
        
        function resetLayout() {
            Object.values(draggableElements).forEach(element => {
                element.style.left = 'auto';
                element.style.top = 'auto';
            });
            
            localStorage.removeItem('certificateLayout');
            savedLayout = null;
            
            // Show status message
            const statusMessage = document.getElementById('statusMessage');
            statusMessage.className = 'status-message success-message';
            statusMessage.textContent = 'Layout reset to default!';
            
            setTimeout(() => {
                statusMessage.style.display = 'none';
            }, 3000);
        }
        
        function saveStyles() {
            localStorage.setItem('certificateStyles', JSON.stringify(savedStyles));
        }
        
        function loadStyles() {
            const saved = localStorage.getItem('certificateStyles');
            if (saved) {
                savedStyles = JSON.parse(saved);
                updateElementSelector();
                applyAllStyles();
            }
        }
        
        // Initialize the app
        updateOrientation();
    </script>
</body>
</html>
